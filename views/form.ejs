<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head'); %>
    <link rel="stylesheet" href="/static/css/input.css" />
  </head>
  <body class="flex-center">
    <div id="main" x-data="Input">
      <div class="block">
        <!-- INPUT SECTION -->
        <div class="section" id="input">
          <input
            type="text"
            name="postaja"
            placeholder="postaja"
            autocomplete="off"
            x-model="input"
            @input="onInput"
          />
          <div class="reset" @click="resetInput" x-show="!!input">x</div>
        </div>

        <!-- NEDAVNA ISKANJA SECTION -->
        <div class="section" id="zgodovina" x-show="!input&&stopHistory.length" x-cloak>
          <template x-for="stop in stopHistory">
            <div
              class="postaja"
              x-text="stop.name"
              :data-id="stop.ref_id"
              @click="input = stop.name"
            ></div>
          </template>
        </div>

        <!-- POSTAJE SEARCH SECTION -->
        <div class="section" id="postaje" x-show="stopSearch.length" x-cloak>
          <template x-for="stop in stopSearch">
            <div
              class="postaja"
              x-text="stop.name+(stop.center?' (C)':' (N)')"
              :data-id="stop.ref_id"
              @click="select(stop.ref_id)"
              :class="{selected: station.ref_id===stop.ref_id}"
              :style="{babbckground: stopColor(stop.ref_id)}"
            ></div>
          </template>
        </div>

        <!-- LINIJE SECTION -->
        <div class="section" id="linije" x-show="routes.length" x-cloak>
          <template x-for="r in routes">
            <div class="linija" x-show="!loading">
              <div class="stevilka" x-text="r[0].key" @click="showMap(r[0].key)"></div>
              <span
                class="prihodi"
                x-text="r.map(i=> (eta?i.minutes+' min':i.time)).slice(0, 3).join(', ')"
                @click="eta=!eta"
              ></span>
            </div>
          </template>
        </div>

        <span x-cloak id="loadingText" x-show="loading">nalaganje ..</span>
        <span x-cloak id="emptyText" x-show="station.name && !loading && !routes.length">ni rezultatov.</span>
      </div>
    </div>

    <img src="/static/img/bus.png" alt="" id="busek" />

    <script>
      const $ = (sel) => document.querySelector(sel);
      const random = (min, max) => min + Math.random() * (max - min);

      function izletek() {
        $('#busek').style.animation = '';
        setTimeout(() => ($('#busek').style.animation = `izletek ${window.innerWidth / 50}s linear`), 100);
        $('#busek').onanimationend = () => setTimeout(izletek, random(100_000, 300_000));
      }

      setTimeout(izletek, random(100_000, 300_000));
    </script>

    <script src="/static/js/stations.js"></script>

    <!-- <script src="/static/js/alea1.1.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script src="/static/js/Input.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </body>
</html>
