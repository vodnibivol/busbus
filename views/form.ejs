<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head'); %>
    <link rel="stylesheet" href="/static/css/input.css" />
  </head>
  <body class="flex-center">
    <div id="main" x-data="Input">
      <div class="live-dot" :class="{live:autoRefresh}" @click="autoRefresh=!autoRefresh"></div>

      <div class="block">
        <!-- INPUT SECTION -->
        <div class="section" id="input">
          <input type="text" name="postaja" placeholder="postaja" autocomplete="off" x-model="input" @input="onInput" />
          <div class="reset" @click="resetInput" x-show="!!input">x</div>
        </div>

        <!-- NEDAVNA ISKANJA SECTION -->
        <div class="section" id="zgodovina" x-show="!input&&filteredHistory.length" x-cloak>
          <template x-for="stop in filteredHistory">
            <div class="postaja" x-text="stop.name" @click="input=stop.name"></div>
          </template>
        </div>

        <!-- ISKANJE FILTER SECTION -->
        <div class="section" id="postaje" x-show="stopSearch.length" x-cloak>
          <template x-for="stopName in stopSearch">
            <div
              class="postaja"
              x-text="stopName"
              @click="onInput()||(input=stopName)"
              :class="{selected: input === stopName}"
            ></div>
          </template>
        </div>

        <!-- POSTAJE MOÅ½NOSTI SECTION -->
        <div class="section" id="postaje" x-show="filteredStopOptions.length" x-cloak>
          <template x-for="option in filteredStopOptions">
            <div
              class="postaja"
              x-text="option.text"
              @click="select(option.ref_id)"
              :class="{selected: selectedStop.ref_id === option.ref_id}"
            ></div>
          </template>
        </div>

        <!-- LINIJE SECTION -->
        <div class="section" id="linije" x-show="!loading && routes.length" x-cloak>
          <template x-for="r in routes">
            <div class="linija">
              <div class="stevilka" x-text="r[0].key" @click="showMap(r[0].key)"></div>
              <span
                class="prihodi"
                x-text="r.map(i=>(eta?i.minutes+' min':i.time)).slice(0,3).join(', ')"
                @click="eta=!eta"
                :style="{textDecoration: dataAge >= maxAge && 'line-through'}"
              ></span>
            </div>
          </template>
        </div>

        <span x-cloak id="loadingText" x-show="loading">nalaganje ..</span>
        <span x-cloak id="emptyText" x-show="selectedStop.name && !loading && !routes.length">ni rezultatov.</span>
      </div>
    </div>

    <img src="/static/img/bus.png" alt="" id="busek" />

    <script>
      const $ = (sel) => document.querySelector(sel);
      const random = (min, max) => min + Math.random() * (max - min);

      function izletek() {
        $('#busek').style.animation = '';
        setTimeout(() => ($('#busek').style.animation = `izletek ${window.innerWidth / 50}s linear`), 100);
        $('#busek').onanimationend = () => setTimeout(izletek, random(100_000, 300_000));
      }

      setTimeout(izletek, random(100_000, 300_000));
    </script>

    <script src="/static/js/stations.js"></script>

    <!-- <script src="/static/js/alea1.1.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script src="/static/js/Input.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </body>
</html>
